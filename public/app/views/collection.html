<form ng-model="selectedCollection" novalidate>

	<!-- Page Header -->
	<div class="container-fluid noSpaceMobile">
	  <div class="col-md-12">
	  	<!-- Title -->
	  	<h3 class="pageHeading">
	  		<span ng-if="collectionsLoading" class="fadeInOut">Loading...</span>
	  		<!--<span ng-if="!collectionsLoading && currentAction == 'create'" class="fadeInOut">New User</span>-->
	  		<span ng-if="!collectionsLoading && currentAction == 'update'" class="fadeInOut">{{ collections[primaryCollection].pluralLabel }}</span>
	  	</h3>
	  	<!-- Breadcrumb -->
	  	<div class="breadCrumb">
	    	<a href="javascript:history.back()"><span class="fa fa-arrow-left"></span> Back to all settings</a>
	  	</div>
	  </div>
	</div>
	<!-- Page Header -->

	<!-- Upgrade indicator -->
	<div class="container-fluid noSpaceMobile">
		<div class="upgradeAlert clearfix">
			<span class="upgradeAlertIcon"><i class="fa fa-trophy iconXL"></i></span>
			<span class="upgradeAlertText"><strong>Take your work to the next level!</strong><br/> With WorkWoo pro, import and track items that relate to {{ collections[primaryCollection].pluralLabel }}, like documents, employees, or inventory</span>
			<span class="upgradeAlertButton">
				<a href="#/upgrade" class="btn btn-success">Upgrade Today</a>
			</span>
		</div>
	</div>
	<!-- Upgrade indicator -->

	<!-- Page Content -->
	<div class="container-fluid noSpaceMobile singleItemContainer">

		<!-- Basic settings & state choices -->
		<div class="col-md-6">

			<!-- Collection name -->
			<div class="col-md-12 noSpace">
				<label>Your items:</label>
				<input ng-disabled="collectionsLoading" type="text" id="collectionName" name="singleLabel" class="form-control defaultInput" value="" ng-model="selectedCollection.pluralLabel" size="20"/>
			</div>

			<!-- Number prefix -->
			<div class="col-md-12 noSpace">
				<label>Number prefix:</label>
				<input ng-disabled="collectionsLoading" type="text" id="numberPrefix" name="numberPrefix" class="form-control defaultInput" value="" ng-model="selectedCollection.numberPrefix" size="20"/>
			</div>

			<!-- State choices -->
			<div class="col-md-12 noSpace">
				<label>State Choices:</label>
				<div id="stateChoices" class="choiceOptionContainer clearfix">
					<!-- Create a row for each state -->
					<div ng-repeat="choice in selectedCollection.stateChoices track by $index" ng-if="!field.sysProvided" class="col-md-12 noSpace">
            			<div class="input-group" style="margin-bottom:3px;">
            				<input ng-disabled="collectionsLoading" class="form-control defaultInput" ng-model="selectedCollection.stateChoices[$index]" style="border-right:none;" type="text">
            				<span ng-click="removeState($index)" class="input-group-addon removeChoiceIcon" style="border-left:none;">
            					<i class="fa fa-remove"></i>
            				</span>
            			</div>
					</div>
					<!-- Add state button -->
					<div class="col-md-12 noSpace">
						<button ng-disabled="collectionsLoading" ng-click="selectedCollection.stateChoices.push('- New state -')" class="btn btn-primary btn-block">
              				<span class="fa fa-plus"></span>
              				<span> Add State</span>
              			</button>
					</div>
				</div>
            </div>
            <!-- State choices -->

		</div>
		<!-- Basic settings & state choices -->

		<!-- Custom fields -->
		<div class="col-md-6">
			<label>Custom fields:</label>
			<div class="choiceOptionContainer clearfix">
				<!-- Column header -->
				<div class="col-md-5 hideInMobile">
					<span class="customFieldColumnTitle">Field Name</span>
				</div>
				<div class="col-md-5 hideInMobile">
					<span class="customFieldColumnTitle">Type</span>
				</div>

				<!-- Loop through each field -->
				<div ng-repeat="(fieldIndex, field) in selectedCollection.fields" ng-if="!field.sysProvided" class="col-md-12 noSpace customFieldRow">
					<!-- Field name -->
					<div class="col-md-5" style="margin-bottom:5px;">
						<input ng-disabled="collectionsLoading" type="text" ng-model="field.label" ng-change="field.name = lowerAndRemoveSpace(field.label)" ng-init="field.name = lowerAndRemoveSpace(field.label)" class="form-control defaultInput" size="20">
					</div>
					<!-- Field type -->
					<div class="col-md-5" style="margin-bottom:5px;">
		              	<!-- If a custom field, allow different types -->
						<select ng-disabled="collectionsLoading" class="form-control defaultInput" ng-model="field.displayType">
		            		<option value="text">Text Input</option>
		            		<option value="textarea">Text Area</option>
		            		<option value="checkbox">Checkbox</option>
		            		<option value="datetime">Date/Time</option>
		            		<option value="choice">Dropdown with options</option>
		            		<option disabled="true" value="SingleReference">One User (Pro only)</option>
		            		<option disabled="true" value="ReferenceList">List of Users (Pro only)</option>
		            		<option disabled="true" value="SingleReference">One Item (Pro only)</option>
		            		<option disabled="true" value="ReferenceList">List of Items (Pro only)</option>
		            	</select>

		            	<!-- If the field is a choice type, show the choices editor -->
		            	<span ng-if="field.displayType == 'choice'" class="fade-in-out">
			            	<button ng-disabled="collectionsLoading" data-toggle="collapse" data-target="#{{fieldIndex}}_choices" class="btn btn-primary btn-block" style="margin-bottom:3px;">
			            		<i class="fa fa-bars"></i>
			            		<span>Show options</span>
			            	</button>
			            	
			            	<div ng-attr-id="{{fieldIndex}}_choices" class="collapse">
			            		
			            		<!-- No options -->
			            		<div ng-if="field.choices.length == 0" class="col-md-12 noSpace">
			            			<input disabled="true" class="form-control defaultInput" value="No options added" style="border-right:none;" type="text">
			            		</div>

			            		<!-- One row for each option -->
			            		<div ng-repeat="(choiceIndex, choice) in field.choices track by $index" class="col-md-12 noSpace">
			            			<div class="input-group" style="margin-bottom:3px;">
			            				<input ng-disabled="collectionsLoading" class="form-control defaultInput" ng-model="field.choices[$index]" style="border-right:none;" type="text">
			            				<span ng-disabled="collectionsLoading" ng-click="removeOption(fieldIndex, choiceIndex)" class="input-group-addon removeChoiceIcon" style="border-left:none;">
			            					<i class="fa fa-remove"></i>
			            				</span>
			            			</div>
			            		</div>

			            		<div class="col-md-12 noSpace">
				              		<button ng-disabled="collectionsLoading" ng-click="field.choices.push('- New choice -')" class="btn btn-primary btn-block">
				              			<span class="fa fa-plus"></span>
				              			<span> Add option</span>
				              		</button>
			              		</div>
			              	</div>
		              	</span>
					</div>

					<!-- Remove field button -->
					<div class="col-md-2 text-right">
						<span ng-disabled="collectionsLoading" ng-click="removeField(fieldIndex)" class="hideInMobile customFieldRemoveIcon fa fa-remove"></span>
						<button ng-click="removeField(fieldIndex)" class="btn btn-default btn-block hideInDesktop">
							<span class="fa fa-remove" style="color:#a86c67;"></span>
							<span>Remove field</span>
						</button>
					</div>
				</div>
				<!-- End loop through each field -->

				<!-- Add new field button-->
				<div class="col-md-12 noSpace">
					<button ng-disabled="collectionsLoading" ng-click="addNewField()" class="btn btn-primary btn-block">
						<span class="fa fa-plus"></span>
						<span> Add new field</span>
					</button>
				</div>	
			</div>
		</div>
		<!-- Custom fields -->

		<!-- Buttons -->
		<div class="col-md-12" style="margin-bottom:10px;">
			<!-- Spacer -->
			<div class="col-md-9"></div>
			<div class="col-md-3">
				<button ng-disabled="collectionsLoading" ng-if="currentAction == 'update'" ng-click="updateCollection()" class="btn btn-success btn-block">
					<!-- Loading -->
					<span ng-if="collectionsLoading && !selectedCollection">
						<i class="fa fa-refresh fa-spin"></i>
						<span> Loading</span>
					</span>
					<!-- Not loading -->
					<span ng-if="!collectionsLoading">Save changes</span>
					<!-- Submitting -->
					<span ng-if="collectionsLoading && selectedCollection">
						<i class="fa fa-refresh fa-spin"></i>
						<span> Saving</span>
					</span>
				</button>
			</div>
			<div class="col-md-12 text-right">
				<span style="font-style:italic;">Saving may take a few seconds. Once this is done, your browser will reload</span>
			</div>
		</div>
	</div>
	<!-- Page Content -->
</form>
